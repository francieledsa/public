# PLSQL
 Códigos PLSQL
 
CREATE OR REPLACE PROCEDURE WS_PRC_INSERT_EXAVISOS IS

 BEGIN

   MERGE INTO EX_AVISOS A
      USING (SELECT DISTINCT CHAVE_PRINCIPAL, CDCONTRA, RGSUPLEM, CHASSI_VEICULO FROM TMP_TABLE
             WHERE CDCONTRA IN ('CONTRAT01','CONTRAT02')
             ) B
         ON (A.CDCONCLI = B.CHAVE_PRINCIPAL)    
       WHEN MATCHED THEN
        UPDATE SET A.FHULTMOD = TRUNC(SYSDATE), A.RGSUPLEM = B.RGSUPLEM
             WHERE A.CDCONTRA = B.CDCONTRA
               AND A.CDCONCLI = B.CHAVE_PRINCIPAL
       WHEN NOT MATCHED THEN 
        INSERT
         (RGAVISO,TPAVISO,FHALTA,FHULTMOD,CDUSUMOD,CDCONCLI,TXAVISO,CDCONTRA,RGSUPLEM,TPATRFIJ,TXVALATR,SWPROPUES,SWALLCON)VALUES
         (SEQ_EXAVISOS('SQ_RGAVIS'),'V',TRUNC(SYSDATE),TRUNC(SYSDATE),'BANCO',B.CHAVE_PRINCIPAL,'ATENÇÃO! VIP',B.CDCONTRA, B.RGSUPLEM, 'BAS',B.CHASSI_VEICULO,'S','S');
 
  EXCEPTION
    WHEN UTL_FILE.INVALID_PATH THEN
      RAISE_APPLICATION_ERROR(-20001, 'UTL_FILE.INVALID_PATH');
    WHEN UTL_FILE.INVALID_MODE THEN
      RAISE_APPLICATION_ERROR(-20002, 'UTL_FILE.INVALID_MODE');
    WHEN UTL_FILE.INVALID_FILEHANDLE THEN
      RAISE_APPLICATION_ERROR(-20003, 'UTL_FILE.INVALID_FILEHANDLE');
    WHEN UTL_FILE.INVALID_OPERATION THEN
      RAISE_APPLICATION_ERROR(-20004, 'UTL_FILE.INVALID_OPERATION');
    WHEN UTL_FILE.INVALID_MAXLINESIZE THEN
     RAISE_APPLICATION_ERROR(-20006, 'UTL_FILE.OTHER_ERROR - '||SUBSTRB(SQLERRM,1,30));
  END;